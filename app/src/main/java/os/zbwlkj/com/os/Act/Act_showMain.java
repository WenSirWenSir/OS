package os.zbwlkj.com.os.Act;import android.animation.ObjectAnimator;import android.animation.ValueAnimator;import android.annotation.SuppressLint;import android.content.Intent;import android.graphics.Color;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.os.PersistableBundle;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentTransaction;import android.util.Log;import android.view.KeyEvent;import android.view.View;import android.view.ViewGroup;import android.view.Window;import android.view.animation.AnticipateOvershootInterpolator;import android.view.animation.BounceInterpolator;import android.widget.TextView;import android.widget.Toast;import java.util.ArrayList;import java.util.List;import java.util.Timer;import java.util.TimerTask;import os.zbwlkj.com.os.Act.Shop.toPayshop;import os.zbwlkj.com.os.Class.ShockInterpolator;import os.zbwlkj.com.os.Class.action_class;import os.zbwlkj.com.os.Class.fragment_class;import os.zbwlkj.com.os.Fragment.Me;import os.zbwlkj.com.os.Fragment.Shop;import os.zbwlkj.com.os.R;import os.zbwlkj.com.os.Utils.TextUnt;import os.zbwlkj.com.os.Utils.Utils;import os.zbwlkj.com.os.Utils.animatorFactor;/** * 展示商品/票跟/干货/生鲜/水果/饮料/牛奶/零食的界面 * 用来驱动Fragment的管理器 */public class Act_showMain extends fragment_class {    private String MSG = "Act_showMain.java[+]";    private TextView btn_pay;    private TextView btn_me;    private int action = 0;/*表示是商品*/    private FragmentManager fragmentManager;    private Boolean first_back = true;/*判断是否为第一次请求退出*/    private Boolean first_in = true;/*判断程序是否第一次运行*/    private static final String CURRENT_FRAGMENT = "CURRENT_FRAGMENT";/*标识内存重启的保存值*/    private Fragment CurrentFragment = new Fragment();/*当前显示的Fragment*/    private List<Fragment> FragmentList = new ArrayList<>();    private int CurrentFragmentPosition = 0;/*显示的Fragment的游标*/    private static final int ON_LOGIN_OK = 1;/*登录成功*/    @SuppressLint("HandlerLeak")    private Handler handler = new Handler() {        @Override        public void handleMessage(Message msg) {            switch (msg.what) {                case ON_LOGIN_OK:                    btn_me.callOnClick();                    break;            }            super.handleMessage(msg);        }    };    @Override    protected void onCreate(Bundle savedInstanceState) {        getWindow().requestFeature(Window.FEATURE_CONTENT_TRANSITIONS);        setTransparentBar();        setInTransition(action_class.TRANSITION.SLIDE);/*设置进入动画 */        setOutTransition(action_class.TRANSITION.EXPLODE);/*设置退出动画*/        setContentView(R.layout.act_showmain);        btn_me = findViewById(R.id.act_showmain_btnMe);/*点击我的*/        super.onCreate(savedInstanceState);        fragmentManager = getSupportFragmentManager();        /*判断是否内存重启*/        if (savedInstanceState != null) {            Log.i(MSG, "saveInstanceState不为NULL");        } else {            Log.i(MSG, "saveInstanceState为NULL");            switch (action) {                case action_class.SHOW_MAIN_TYPE.SHOP:                    FragmentList.add(new Shop());                    break;            }            FragmentList.add(new Me());            toShowFrg();        }        init();    }    /**     * 展示界面     */    private void toShowFrg() {        try {            FragmentTransaction transaction = fragmentManager.beginTransaction();            //如果之前没有添加过            if (!FragmentList.get(CurrentFragmentPosition).isAdded()) {                transaction.setCustomAnimations(R.anim.fragment_toright, R.anim                        .fragment_exittoleft);                transaction.hide(CurrentFragment).add(R.id.act_showmain_framelayout, FragmentList                        .get(CurrentFragmentPosition), "" + CurrentFragmentPosition);                //第三个参数为添加当前的fragment时绑定一个tag            } else {                transaction.setCustomAnimations(R.anim.fragment_toright, R.anim                        .fragment_exittoleft);                transaction.hide(CurrentFragment).show(FragmentList.get(CurrentFragmentPosition));            }            CurrentFragment = FragmentList.get(CurrentFragmentPosition);            transaction.commit();        } catch (Exception e) {        }    }    /**     * 系统初始化     */    private void init() {        /**         * 获取屏幕高度和宽度  用来获取一张正确的海报         */        int MetricHeight = getHeightPixels();        switch (action) {            case action_class.SHOW_MAIN_TYPE.SHOP:                /*展示的是商品的界面*/                break;        }        ValueAnimator valueAnimator = ValueAnimator.ofInt(0, 250);        btn_pay = findViewById(R.id.act_showmain_btnPay);        valueAnimator.setDuration(1500);        valueAnimator.setInterpolator(new ShockInterpolator());        valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {            @Override            public void onAnimationUpdate(ValueAnimator animation) {                ViewGroup.LayoutParams layoutParams = btn_pay.getLayoutParams();                layoutParams.width = (int) animation.getAnimatedValue();                btn_pay.setLayoutParams(layoutParams);            }        });        valueAnimator.start();        TextUnt.with(this, R.id.act_showmain_btnPay).setBackground(Utils.CreateDrawable                (getApplicationContext(), 1, R.color.color_success, R.color.color_success, 10));        listener();    }    /**     * 初始化监听事件     */    private void listener() {        /**         * 退出监听         */        setOnbackListener(R.id.act_showmain_btnBack, false);        /*初始化界面  设置导航的字号*/        TextUnt.with(this, R.id.act_showmain_btnHome).setTextSize(18).setOnClick(new View                .OnClickListener() {            @Override            public void onClick(View v) {                TextUnt.with(Act_showMain.this, R.id.act_showmain_btnHome).setTextSize(18)                        .setTextColor(Color.WHITE);                TextUnt.with(Act_showMain.this, R.id.act_showmain_btnMe).setTextSize(17)                        .setTextColor("#bfbfbf");                CurrentFragmentPosition = 0;                /**                 * 设置一个属性动画 用来显示Pay的按钮                 */                ObjectAnimator animator = ObjectAnimator.ofFloat(btn_pay, "alpha", 0.0f, 1.0f);                animator.setInterpolator(new AnticipateOvershootInterpolator());                animator.start();                toShowFrg();                /**                 * 显示分享和退出按钮                 */                findViewById(R.id.act_showmain_btnBack).setVisibility(View.VISIBLE);                findViewById(R.id.act_showmain_btnShare).setVisibility(View.VISIBLE);            }        });        /**         * 点击Me的监听事件         */        TextUnt.with(this, R.id.act_showmain_btnMe).setOnClick(new View.OnClickListener() {            @Override            public void onClick(View v) {                TextUnt.with(Act_showMain.this, R.id.act_showmain_btnMe).setTextSize(18)                        .setTextColor("#ffffff");                TextUnt.with(Act_showMain.this, R.id.act_showmain_btnHome).setTextSize(17)                        .setTextColor("#020433");                CurrentFragmentPosition = 1;                /**                 * 设置一个属性动画 用来隐藏Pay的按钮                 */                ObjectAnimator animator = ObjectAnimator.ofFloat(btn_pay, "alpha", 1.0f, 0.0f);                animator.setInterpolator(new AnticipateOvershootInterpolator());                animator.start();                if (!Utils.getToKen(getApplicationContext(), action_class.SAVE_USER.ACCOUNT)                        .equals("123087")) {                    StartActforResult(Act_login.class, false, 1);                } else {                    toShowFrg();                }                /**                 * 隐藏退出和分享按钮                 */                findViewById(R.id.act_showmain_btnBack).setVisibility(View.GONE);                findViewById(R.id.act_showmain_btnShare).setVisibility(View.GONE);            }        });        /**         * 点击购买的按钮的事件         */        TextUnt.with(this, R.id.act_showmain_btnPay).setOnClick(new View.OnClickListener() {            @Override            public void onClick(View v) {                switch (action) {                    case action_class.SHOW_MAIN_TYPE.SHOP:                        /*购买的东西为商品*/                        StartAct(toPayshop.class,false);                        break;                }            }        });    }    @Override    public void onSaveInstanceState(Bundle outState, PersistableBundle outPersistentState) {        outState.putInt(CURRENT_FRAGMENT, CurrentFragmentPosition);        super.onSaveInstanceState(outState);    }    @Override    public void onResume() {        Log.i(MSG, "onResume");        if (first_in) {            first_in = false;        } else {            /**             * 重新启动 判断是否登录             */            if (!true) {            } else {                /**                 * 设置一个属性动画 用来显示Pay的按钮                 */                ObjectAnimator animator = ObjectAnimator.ofFloat(btn_pay, "alpha", 0.0f, 1.0f);                animator.setInterpolator(new AnticipateOvershootInterpolator());                animator.start();            }        }        super.onResume();    }    @Override    public void onPause() {        Log.i(MSG, "onPause");        super.onPause();    }    @Override    public void onStop() {        Log.i(MSG, "onStop");        super.onStop();    }    @Override    public void onStart() {        Log.i(MSG, "onStart");        super.onStart();    }    @Override    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {        switch (requestCode) {            case 1:                if (resultCode == RESULT_OK) {                    Boolean i = data.getBooleanExtra(action_class.SAVE_USER.STATUS, false);                    if (i) {                        Thread thread = new Thread(new Runnable() {                            @Override                            public void run() {                                Message msg = new Message();                                msg.what = ON_LOGIN_OK;                                handler.sendMessage(msg);                            }                        });                        thread.start();                        Log.e(MSG, "登录系统成功");                    } else {                        Log.e(MSG, "登录系统失败");                    }                }                break;        }    }    @Override    public boolean onKeyDown(int keyCode, KeyEvent event) {        if (event.getKeyCode() == KeyEvent.KEYCODE_BACK) {            Log.i(MSG, "点击一次");            /**             * 判断是不是第一个界面             */            if (CurrentFragmentPosition == 0) {                if (first_back) {                    first_back = false;                    Toast.makeText(getApplicationContext(), "请再按一次退出", Toast.LENGTH_SHORT).show();                    /*三秒内没有再按一次的话  就重新计算一次*/                    final Timer timer = new Timer();                    timer.schedule(new TimerTask() {                        @Override                        public void run() {                            first_back = true;                            timer.cancel();                        }                    }, 3000);                } else {                    finish();                }            } else {                /*不是第一个界面  就回退到第一个界面*/                ObjectAnimator animator = ObjectAnimator.ofFloat(btn_pay, "alpha", 0.0f, 1.0f);                animator.setInterpolator(new AnticipateOvershootInterpolator());                animator.start();                CurrentFragmentPosition = 0;                toShowFrg();            }        }        return false;    }}